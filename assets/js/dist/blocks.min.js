(()=>{var{registerBlockType:x}=wp.blocks,{__:r}=wp.i18n,{useBlockProps:k,InspectorControls:f,MediaUpload:B,MediaUploadCheck:I}=wp.blockEditor,{PanelBody:y,TextControl:g,TextareaControl:b,ToggleControl:U,SelectControl:w,Button:h,Dashicon:L}=wp.components,T=wp.serverSideRender,{Fragment:p,createElement:n}=wp.element;console.log("Greenergy Blocks: Script starting v3 (Refactored)...");var v=({label:u,imageUrl:t,imageId:l,onSelect:s,onSelectURL:m})=>n("div",{style:{marginBottom:"15px"}},n("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},u),n("div",{style:{display:"flex",gap:"10px",alignItems:"center"}},n(I,null,n(B,{onSelect:a=>s(a),allowedTypes:["image"],value:l,render:({open:a})=>n(h,{isSecondary:!0,onClick:a},r(l?"Change Image":"Select from Library","greenergy"))})),n(g,{placeholder:r("Or enter URL...","greenergy"),value:t,onChange:m,style:{marginBottom:0,flex:1}})),(t||l)&&n("div",{style:{marginTop:"10px",textAlign:"center"}},n("img",{src:t||(l?"placeholder":""),style:{maxWidth:"100%",maxHeight:"100px",borderRadius:"4px",border:"1px solid #ddd"}}),n(h,{isDestructive:!0,isLink:!0,onClick:()=>{s({id:0,url:""}),m("")}},r("Remove","greenergy")))),M=u=>{let{attributes:t,setAttributes:l,name:s}=u,m=k();console.log(`[Greenergy DEBUG] Editing block: ${s}`,t);let a=(c,e)=>{l({[c]:e})},S=()=>{switch(s){case"greenergy/hero-block":return n(p,null,n(y,{title:r("General Settings","greenergy")},n(g,{label:r("Badge Text","greenergy"),value:t.badgeText,onChange:e=>a("badgeText",e)}),n(g,{label:r("Headline Highlight","greenergy"),value:t.headlineHighlight,onChange:e=>a("headlineHighlight",e)}),n(g,{label:r("Headline Main","greenergy"),value:t.headlineMain,onChange:e=>a("headlineMain",e)}),n(b,{label:r("Description","greenergy"),value:t.description,onChange:e=>a("description",e)}),n(g,{label:r("CTA Text","greenergy"),value:t.ctaText,onChange:e=>a("ctaText",e)}),n(g,{label:r("CTA URL (Page)","greenergy"),value:t.ctaUrl,onChange:e=>a("ctaUrl",e)}),n(v,{label:r("Hero Image","greenergy"),imageUrl:t.imageUrl,imageId:t.imageId,onSelect:e=>l({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>a("imageUrl",e)})),n(y,{title:r("Stats Settings","greenergy"),initialOpen:!1},n(w,{label:r("Stats Display Mode","greenergy"),value:t.viewMode,options:[{label:r("Static (Manual)","greenergy"),value:"static"},{label:r("Real Time (Database)","greenergy"),value:"real"}],onChange:e=>a("viewMode",e)}),t.viewMode==="static"&&n(p,null,n("div",{style:{fontWeight:"bold",marginBottom:"10px"}},r("Manual Stats","greenergy")),t.stats.map((e,o)=>n("div",{key:o,style:{padding:"10px",border:"1px solid #eee",marginBottom:"10px"}},n(g,{label:r("Value","greenergy"),value:e.value,onChange:d=>{let i=[...t.stats];i[o].value=d,l({stats:i})}}),n(g,{label:r("Label","greenergy"),value:e.label,onChange:d=>{let i=[...t.stats];i[o].label=d,l({stats:i})}}))),n("div",{style:{fontWeight:"bold",margin:"15px 0 10px"}},r("Featured Stat (Blue Box)","greenergy")),n(g,{label:r("Value","greenergy"),value:t.featuredStat.value,onChange:e=>l({featuredStat:{...t.featuredStat,value:e}})}),n(g,{label:r("Label","greenergy"),value:t.featuredStat.label,onChange:e=>l({featuredStat:{...t.featuredStat,label:e}})}))));case"greenergy/stories":let c=t.stories||[];return n(y,{title:r("Stories Settings","greenergy")},c.map((e,o)=>n("div",{key:o,style:{marginBottom:"20px",padding:"10px",border:"1px solid #ddd",borderRadius:"4px"}},n("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"}},n("strong",null,`${r("Story #","greenergy")}${o+1}`),n(h,{isDestructive:!0,isSmall:!0,onClick:()=>{let d=[...c];d.splice(o,1),l({stories:d})}},r("Remove","greenergy"))),n(g,{label:r("Label","greenergy"),value:e.label,onChange:d=>{let i=[...c];i[o].label=d,l({stories:i})}}),n(v,{label:r("Story Photo","greenergy"),imageUrl:e.image,imageId:e.imageId,onSelect:d=>{let i=[...c];i[o].imageId=d.id,i[o].image=d.url,l({stories:i})},onSelectURL:d=>{let i=[...c];i[o].image=d,l({stories:i})}}))),n(h,{isPrimary:!0,onClick:()=>{l({stories:[...c,{label:"New Story",image:"",imageId:0,link:"#"}]})}},r("Add New Story","greenergy")));case"greenergy/most-read-news":return n(y,{title:r("Selection Mode","greenergy")},n(w,{label:r("News Mode","greenergy"),value:t.selectionMode,options:[{label:r("Automatic (Top Read)","greenergy"),value:"auto"},{label:r("Manual (Select IDs)","greenergy"),value:"manual"}],onChange:e=>a("selectionMode",e)}),t.selectionMode==="manual"&&n(g,{label:r("News IDs (Comma separated)","greenergy"),value:t.selectedPosts.join(","),onChange:e=>a("selectedPosts",e.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)))}),n(g,{label:r("Badge Text","greenergy"),value:t.badgeText,onChange:e=>a("badgeText",e)}),n(b,{label:r("Description","greenergy"),value:t.description,onChange:e=>a("description",e)}),n(g,{label:r("Button Text","greenergy"),value:t.buttonText,onChange:e=>a("buttonText",e)}));case"greenergy/latest-news":case"greenergy/courses":case"greenergy/jobs":return n(y,{title:r("Section Settings","greenergy")},n(g,{label:r("Badge Text","greenergy"),value:t.badgeText,onChange:e=>a("badgeText",e)}),s==="greenergy/courses"&&n(g,{label:r("Title","greenergy"),value:t.title,onChange:e=>a("title",e)}),n(b,{label:r("Description","greenergy"),value:t.description,onChange:e=>a("description",e)}),s!=="greenergy/latest-news"&&n(g,{label:r("Button Text","greenergy"),value:t.buttonText,onChange:e=>a("buttonText",e)}),n(v,{label:r("Background Image (Optional)","greenergy"),imageUrl:t.imageUrl,imageId:t.imageId,onSelect:e=>l({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>a("imageUrl",e)}));case"greenergy/stats":return n(y,{title:r("Stats Settings","greenergy")},n(g,{label:r("Title","greenergy"),value:t.title,onChange:e=>a("title",e)}),n(b,{label:r("Description","greenergy"),value:t.description,onChange:e=>a("description",e)}));default:return null}},C=()=>{if(s==="greenergy/stories"){let c=t.stories||[];return n("div",{className:"flex gap-4 overflow-x-auto p-4 bg-gray-50 rounded-lg"},c.map((e,o)=>n("div",{key:o,className:"flex-none text-center"},n("div",{className:"w-16 h-16 rounded-full border-2 border-brand-green p-0.5 overflow-hidden mx-auto"},n("img",{src:e.image||"placeholder",className:"w-full h-full object-cover rounded-full"})),n("span",{className:"text-xs mt-1 block font-bold"},e.label))))}return n(T,{block:s,attributes:t})};return n(p,null,n(f,null,S()),n("div",{...m},C()))},N=[{name:"hero-block",title:r("Hero Section","greenergy"),icon:"cover-image"},{name:"stories",title:r("Greenergy Stories","greenergy"),icon:"groups"},{name:"courses",title:r("Greenergy Courses","greenergy"),icon:"welcome-learn-more"},{name:"jobs",title:r("Greenergy Jobs","greenergy"),icon:"businessman"},{name:"latest-news",title:r("Greenergy Latest News","greenergy"),icon:"admin-post"},{name:"most-read-news",title:r("Greenergy Most Read News","greenergy"),icon:"megaphone"},{name:"stats",title:r("Greenergy Global Stats","greenergy"),icon:"chart-area"},{name:"news-filter",title:r("News Filter","greenergy"),icon:"filter"},{name:"featured-news",title:r("Featured News","greenergy"),icon:"cover-image"},{name:"news-list",title:r("News List","greenergy"),icon:"list-view"},{name:"news-grid",title:r("News Grid","greenergy"),icon:"grid-view"},{name:"sidebar",title:r("Sidebar Container","greenergy"),icon:"sidebar"},{name:"directory-widget",title:r("Directory Widget","greenergy"),icon:"building"},{name:"courses-widget",title:r("Courses Widget","greenergy"),icon:"book"},{name:"featured-jobs-widget",title:r("Featured Jobs Widget","greenergy"),icon:"businessman"},{name:"follow-us-widget",title:r("Follow Us Widget","greenergy"),icon:"share"},{name:"breadcrumb",title:r("Breadcrumb","greenergy"),icon:"admin-home"},{name:"main-banner",title:r("Main Banner","greenergy"),icon:"cover-image"},{name:"scroll-progress",title:r("Scroll Progress","greenergy"),icon:"upload"}];N.forEach(u=>{x(`greenergy/${u.name}`,{title:u.title,icon:u.icon,category:"greenergy-blocks",edit:t=>M({...t,name:`greenergy/${u.name}`}),save:()=>null})});x("greenergy/ad-block",{title:r("Greenergy Ad Block","greenergy"),icon:"megaphone",category:"greenergy-blocks",edit:({attributes:u,setAttributes:t})=>{let l=k(),{adType:s,imageUrl:m,imageId:a,adLink:S,adCode:C,fullWidth:c}=u;return n(p,null,n(f,null,n(y,{title:r("Ad Settings","greenergy")},n(w,{label:r("Ad Type","greenergy"),value:s,options:[{label:r("Image banner","greenergy"),value:"image"},{label:r("Custom Code (HTML/JS)","greenergy"),value:"code"}],onChange:e=>t({adType:e})}),s==="image"&&n(p,null,n(v,{label:r("Banner Image","greenergy"),imageUrl:m,imageId:a,onSelect:e=>t({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>t({imageUrl:e})}),n(g,{label:r("Destination Link","greenergy"),value:S,onChange:e=>t({adLink:e})})),s==="code"&&n(b,{label:r("Ad Code","greenergy"),value:C,onChange:e=>t({adCode:e})}),n(U,{label:r("Full Width","greenergy"),checked:c,onChange:e=>t({fullWidth:e})}))),n("div",{...l},n(T,{block:"greenergy/ad-block",attributes:u})))},save:()=>null});})();
