(()=>{var{registerBlockType:k}=wp.blocks,{__:n}=wp.i18n,{useBlockProps:w,InspectorControls:T,MediaUpload:B,MediaUploadCheck:I}=wp.blockEditor,{PanelBody:y,TextControl:g,TextareaControl:b,ToggleControl:U,SelectControl:x,Button:h,Dashicon:R}=wp.components,f=wp.serverSideRender,{Fragment:p,createElement:r}=wp.element;console.log("Greenergy Blocks: Script starting v3 (Refactored)...");var v=({label:u,imageUrl:t,imageId:a,onSelect:s,onSelectURL:m})=>r("div",{style:{marginBottom:"15px"}},r("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},u),r("div",{style:{display:"flex",gap:"10px",alignItems:"center"}},r(I,null,r(B,{onSelect:l=>s(l),allowedTypes:["image"],value:a,render:({open:l})=>r(h,{isSecondary:!0,onClick:l},n(a?"Change Image":"Select from Library","greenergy"))})),r(g,{placeholder:n("Or enter URL...","greenergy"),value:t,onChange:m,style:{marginBottom:0,flex:1}})),(t||a)&&r("div",{style:{marginTop:"10px",textAlign:"center"}},r("img",{src:t||(a?"placeholder":""),style:{maxWidth:"100%",maxHeight:"100px",borderRadius:"4px",border:"1px solid #ddd"}}),r(h,{isDestructive:!0,isLink:!0,onClick:()=>{s({id:0,url:""}),m("")}},n("Remove","greenergy")))),M=u=>{let{attributes:t,setAttributes:a,name:s}=u,m=w();console.log(`[Greenergy DEBUG] Editing block: ${s}`,t);let l=(c,e)=>{a({[c]:e})},S=()=>{switch(s){case"greenergy/hero-block":return r(p,null,r(y,{title:n("General Settings","greenergy")},r(g,{label:n("Badge Text","greenergy"),value:t.badgeText,onChange:e=>l("badgeText",e)}),r(g,{label:n("Headline Highlight","greenergy"),value:t.headlineHighlight,onChange:e=>l("headlineHighlight",e)}),r(g,{label:n("Headline Main","greenergy"),value:t.headlineMain,onChange:e=>l("headlineMain",e)}),r(b,{label:n("Description","greenergy"),value:t.description,onChange:e=>l("description",e)}),r(g,{label:n("CTA Text","greenergy"),value:t.ctaText,onChange:e=>l("ctaText",e)}),r(g,{label:n("CTA URL (Page)","greenergy"),value:t.ctaUrl,onChange:e=>l("ctaUrl",e)}),r(v,{label:n("Hero Image","greenergy"),imageUrl:t.imageUrl,imageId:t.imageId,onSelect:e=>a({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>l("imageUrl",e)})),r(y,{title:n("Stats Settings","greenergy"),initialOpen:!1},r(x,{label:n("Stats Display Mode","greenergy"),value:t.viewMode,options:[{label:n("Static (Manual)","greenergy"),value:"static"},{label:n("Real Time (Database)","greenergy"),value:"real"}],onChange:e=>l("viewMode",e)}),t.viewMode==="static"&&r(p,null,r("div",{style:{fontWeight:"bold",marginBottom:"10px"}},n("Manual Stats","greenergy")),t.stats.map((e,o)=>r("div",{key:o,style:{padding:"10px",border:"1px solid #eee",marginBottom:"10px"}},r(g,{label:n("Value","greenergy"),value:e.value,onChange:d=>{let i=[...t.stats];i[o].value=d,a({stats:i})}}),r(g,{label:n("Label","greenergy"),value:e.label,onChange:d=>{let i=[...t.stats];i[o].label=d,a({stats:i})}}))),r("div",{style:{fontWeight:"bold",margin:"15px 0 10px"}},n("Featured Stat (Blue Box)","greenergy")),r(g,{label:n("Value","greenergy"),value:t.featuredStat.value,onChange:e=>a({featuredStat:{...t.featuredStat,value:e}})}),r(g,{label:n("Label","greenergy"),value:t.featuredStat.label,onChange:e=>a({featuredStat:{...t.featuredStat,label:e}})}))));case"greenergy/stories":let c=t.stories||[];return r(y,{title:n("Stories Settings","greenergy")},c.map((e,o)=>r("div",{key:o,style:{marginBottom:"20px",padding:"10px",border:"1px solid #ddd",borderRadius:"4px"}},r("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"}},r("strong",null,`${n("Story #","greenergy")}${o+1}`),r(h,{isDestructive:!0,isSmall:!0,onClick:()=>{let d=[...c];d.splice(o,1),a({stories:d})}},n("Remove","greenergy"))),r(g,{label:n("Label","greenergy"),value:e.label,onChange:d=>{let i=[...c];i[o].label=d,a({stories:i})}}),r(v,{label:n("Story Photo","greenergy"),imageUrl:e.image,imageId:e.imageId,onSelect:d=>{let i=[...c];i[o].imageId=d.id,i[o].image=d.url,a({stories:i})},onSelectURL:d=>{let i=[...c];i[o].image=d,a({stories:i})}}))),r(h,{isPrimary:!0,onClick:()=>{a({stories:[...c,{label:"New Story",image:"",imageId:0,link:"#"}]})}},n("Add New Story","greenergy")));case"greenergy/most-read-news":return r(y,{title:n("Selection Mode","greenergy")},r(x,{label:n("News Mode","greenergy"),value:t.selectionMode,options:[{label:n("Automatic (Top Read)","greenergy"),value:"auto"},{label:n("Manual (Select IDs)","greenergy"),value:"manual"}],onChange:e=>l("selectionMode",e)}),t.selectionMode==="manual"&&r(g,{label:n("News IDs (Comma separated)","greenergy"),value:t.selectedPosts.join(","),onChange:e=>l("selectedPosts",e.split(",").map(o=>parseInt(o.trim())).filter(o=>!isNaN(o)))}),r(g,{label:n("Badge Text","greenergy"),value:t.badgeText,onChange:e=>l("badgeText",e)}),r(b,{label:n("Description","greenergy"),value:t.description,onChange:e=>l("description",e)}),r(g,{label:n("Button Text","greenergy"),value:t.buttonText,onChange:e=>l("buttonText",e)}));case"greenergy/latest-news":case"greenergy/courses":case"greenergy/jobs":return r(y,{title:n("Section Settings","greenergy")},r(g,{label:n("Badge Text","greenergy"),value:t.badgeText,onChange:e=>l("badgeText",e)}),s==="greenergy/courses"&&r(g,{label:n("Title","greenergy"),value:t.title,onChange:e=>l("title",e)}),r(b,{label:n("Description","greenergy"),value:t.description,onChange:e=>l("description",e)}),s!=="greenergy/latest-news"&&r(g,{label:n("Button Text","greenergy"),value:t.buttonText,onChange:e=>l("buttonText",e)}),r(v,{label:n("Background Image (Optional)","greenergy"),imageUrl:t.imageUrl,imageId:t.imageId,onSelect:e=>a({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>l("imageUrl",e)}));case"greenergy/stats":return r(y,{title:n("Stats Settings","greenergy")},r(g,{label:n("Title","greenergy"),value:t.title,onChange:e=>l("title",e)}),r(b,{label:n("Description","greenergy"),value:t.description,onChange:e=>l("description",e)}));default:return null}},C=()=>{if(s==="greenergy/stories"){let c=t.stories||[];return r("div",{className:"flex gap-4 overflow-x-auto p-4 bg-gray-50 rounded-lg"},c.map((e,o)=>r("div",{key:o,className:"flex-none text-center"},r("div",{className:"w-16 h-16 rounded-full border-2 border-brand-green p-0.5 overflow-hidden mx-auto"},r("img",{src:e.image||"placeholder",className:"w-full h-full object-cover rounded-full"})),r("span",{className:"text-xs mt-1 block font-bold"},e.label))))}return r(f,{block:s,attributes:t})};return r(p,null,r(T,null,S()),r("div",{...m},C()))},L=[{name:"hero-block",title:n("Hero Section","greenergy"),icon:"cover-image"},{name:"stories",title:n("Greenergy Stories","greenergy"),icon:"groups"},{name:"courses",title:n("Greenergy Courses","greenergy"),icon:"welcome-learn-more"},{name:"jobs",title:n("Greenergy Jobs","greenergy"),icon:"businessman"},{name:"latest-news",title:n("Greenergy Latest News","greenergy"),icon:"admin-post"},{name:"most-read-news",title:n("Greenergy Most Read News","greenergy"),icon:"megaphone"},{name:"stats",title:n("Greenergy Global Stats","greenergy"),icon:"chart-area"}];L.forEach(u=>{k(`greenergy/${u.name}`,{title:u.title,icon:u.icon,category:"greenergy-blocks",edit:t=>M({...t,name:`greenergy/${u.name}`}),save:()=>null})});k("greenergy/ad-block",{title:n("Greenergy Ad Block","greenergy"),icon:"megaphone",category:"greenergy-blocks",edit:({attributes:u,setAttributes:t})=>{let a=w(),{adType:s,imageUrl:m,imageId:l,adLink:S,adCode:C,fullWidth:c}=u;return r(p,null,r(T,null,r(y,{title:n("Ad Settings","greenergy")},r(x,{label:n("Ad Type","greenergy"),value:s,options:[{label:n("Image banner","greenergy"),value:"image"},{label:n("Custom Code (HTML/JS)","greenergy"),value:"code"}],onChange:e=>t({adType:e})}),s==="image"&&r(p,null,r(v,{label:n("Banner Image","greenergy"),imageUrl:m,imageId:l,onSelect:e=>t({imageId:e.id,imageUrl:e.url}),onSelectURL:e=>t({imageUrl:e})}),r(g,{label:n("Destination Link","greenergy"),value:S,onChange:e=>t({adLink:e})})),s==="code"&&r(b,{label:n("Ad Code","greenergy"),value:C,onChange:e=>t({adCode:e})}),r(U,{label:n("Full Width","greenergy"),checked:c,onChange:e=>t({fullWidth:e})}))),r("div",{...a},r(f,{block:"greenergy/ad-block",attributes:u})))},save:()=>null});})();
