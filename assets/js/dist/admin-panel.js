(()=>{var{registerBlockType:B}=wp.blocks,{__:l}=wp.i18n,{useBlockProps:C,MediaUpload:S,MediaUploadCheck:T}=wp.blockEditor,{Button:y,TextControl:h}=wp.components;console.log("Greenergy Admin: Social Media Block JS executed.");var v=()=>{let i="greenergy/social-media-settings",a=d=>{let o=d.toLowerCase().trim();return o.includes("twitter")||o.includes(" x")?"fab fa-twitter":o.includes("facebook")?"fab fa-facebook-f":o.includes("instagram")?"fab fa-instagram":o.includes("linkedin")?"fab fa-linkedin-in":o.includes("youtube")?"fab fa-youtube":o.includes("whatsapp")?"fab fa-whatsapp":o.includes("tiktok")?"fab fa-tiktok":o.includes("snapchat")?"fab fa-snapchat-ghost":o.includes("telegram")?"fab fa-telegram-plane":"fas fa-link"};try{console.log("Greenergy Admin: Attempting to register block:",i),wp.blocks.getBlockType(i)&&(console.log("Greenergy Admin: Block already registered, unregistering first."),wp.blocks.unregisterBlockType(i));let d=B(i,{title:l("Social Media Settings","greenergy"),icon:"share",category:"theme",attributes:{items:{type:"array",default:[]}},edit:({attributes:o,setAttributes:m})=>{let{items:g}=o,p=(t,r,e)=>{let n=[...g];n[t][r]=e,m({items:n})},u=()=>{m({items:[...g,{platform:"",url:"",icon:"",iconId:0}]})},f=t=>{let r=g.filter((e,n)=>n!==t);m({items:r})};return wp.element.createElement("div",{...C({className:"greenergy-card-block"})},wp.element.createElement("div",{className:"greenergy-block-header"},wp.element.createElement("h2",null,l("Social Media Links","greenergy")),wp.element.createElement("p",null,l("Add links to your social media profiles. These will appear in the header and footer.","greenergy"))),wp.element.createElement("div",{className:"greenergy-social-list"},g.map((t,r)=>wp.element.createElement("div",{key:r,className:"greenergy-social-item",style:{border:"1px solid #e2e8f0",padding:"15px",borderRadius:"8px",marginBottom:"15px",background:"#f8fafc"}},wp.element.createElement("div",{className:"social-item-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}},wp.element.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},wp.element.createElement("span",{className:"item-count",style:{fontWeight:"bold",color:"#64748b"}},"#",r+1),wp.element.createElement("div",{style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"#fff",border:"1px solid #cbd5e1",borderRadius:"4px"}},t.icon?wp.element.createElement("img",{src:t.icon,alt:"icon",style:{width:"20px",height:"20px",objectFit:"contain"}}):wp.element.createElement("i",{className:a(t.platform),style:{fontSize:"18px",color:"#1e293b"}})),wp.element.createElement("span",{style:{fontWeight:"600"}},t.platform||l("New Platform","greenergy"))),wp.element.createElement(y,{isDestructive:!0,isSmall:!0,variant:"tertiary",onClick:()=>f(r),icon:"trash",label:l("Remove","greenergy")})),wp.element.createElement("div",{className:"social-item-fields",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"}},wp.element.createElement(h,{label:l("Platform Name","greenergy"),value:t.platform,onChange:e=>p(r,"platform",e),placeholder:l("Example: Twitter","greenergy")}),wp.element.createElement(h,{label:l("URL","greenergy"),value:t.url,onChange:e=>p(r,"url",e),placeholder:"https://"})),wp.element.createElement("div",{className:"social-icon-picker",style:{marginTop:"10px"}},wp.element.createElement(T,null,wp.element.createElement(S,{onSelect:e=>{p(r,"icon",e.url),p(r,"iconId",e.id)},allowedTypes:["image"],render:({open:e})=>wp.element.createElement(y,{variant:"secondary",onClick:e,style:{width:"100%"}},t.icon?l("Change Custom Icon","greenergy"):l("Upload Custom Icon (Optional)","greenergy"))}),t.icon&&wp.element.createElement(y,{isDestructive:!0,isLink:!0,onClick:()=>{p(r,"icon",""),p(r,"iconId",0)},style:{marginTop:"5px"}},l("Remove Custom Icon (use default)","greenergy"))))))),wp.element.createElement("div",{className:"add-item-wrapper",style:{marginTop:"20px"}},wp.element.createElement(y,{variant:"primary",icon:"plus",onClick:u,style:{width:"100%",height:"40px",justifyContent:"center"}},l("Add New Platform","greenergy"))))},save:()=>null});console.log("Greenergy Admin: Block registered result:",d?"SUCCESS":"FAILED")}catch(d){console.error("Greenergy Admin: Block registration EXCEPTION:",d)}};wp&&wp.blocks&&wp.blocks.registerBlockType?v():wp.domReady?wp.domReady(v):document.addEventListener("DOMContentLoaded",v);var{createRoot:N,useState:b,useEffect:A}=wp.element,{BlockEditorProvider:E,BlockTools:I,WritingFlow:G,ObserveTyping:x}=wp.blockEditor,{SlotFillProvider:R,Popover:P,Button:L,SnackbarList:D}=wp.components,{registerBlockType:U}=wp.blocks,F=wp.apiFetch,M=()=>{let[i,a]=b([]),[d,o]=b(!1),[m,g]=b([]);A(()=>{if(console.log("Greenergy Admin: Effect running."),typeof greenergySettings>"u"){console.error("Greenergy Admin: greenergySettings is UNDEFINED!");return}console.log("Greenergy Admin: greenergySettings found:",greenergySettings);let e=greenergySettings.blocks,n=wp.blocks.getBlockTypes().map(s=>s.name);if(console.log("Greenergy Admin: Registered blocks count:",n.length),console.log("Greenergy Admin: Registered blocks list:",n),e&&typeof e=="string"&&e.trim()!==""){console.log("Greenergy Admin: Found saved blocks content (length):",e.length);try{let s=wp.blocks.parse(e);console.log("Greenergy Admin: Parsed blocks successfully. Count:",s.length),a(s)}catch(s){console.error("Greenergy Admin: Error parsing saved blocks:",s)}}else{console.log("Greenergy Admin: No saved blocks or empty. Attempting default init.");let s="greenergy/social-media-settings";if(wp.blocks.getBlockType(s)){console.log("Greenergy Admin: Block type found. Creating default.");let k=wp.blocks.createBlock(s);a([k])}else console.error(`Greenergy Admin: Block "${s}" NOT registered.`)}},[]);let p=e=>{a(e)},u=e=>{a(e)},f=async()=>{o(!0);let e=wp.blocks.serialize(i),n=[];i.forEach(c=>{c.name==="greenergy/social-media-settings"&&c.attributes&&c.attributes.items&&(n=[...n,...c.attributes.items])});let s={social_media:n};try{await F({path:"/greenergy/v1/save-settings",method:"POST",data:{blocks:e,settings:s}}),t("Settings saved successfully!","success")}catch(c){console.error(c),t(c.message||"Error saving settings.","error")}finally{o(!1)}},t=(e,n="success")=>{let s={id:Date.now(),content:e,status:n};g([...m,s]),setTimeout(()=>{g(c=>c.filter(k=>k.id!==s.id))},3e3)},r={mediaUpload:wp.blockEditor.MediaUpload,hasFixedToolbar:!0};return wp.element.createElement("div",{className:"greenergy-admin-layout"},wp.element.createElement("div",{className:"greenergy-admin-header"},wp.element.createElement("h1",null,"\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0642\u0627\u0644\u0628"),wp.element.createElement("div",{style:{background:"#eee",padding:"5px",margin:"0 10px",fontSize:"10px"}},"Debug: React Loaded"),wp.element.createElement(L,{variant:"primary",isBusy:d,onClick:f},d?"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...":"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A")),wp.element.createElement("div",{className:"greenergy-block-editor"},wp.element.createElement(R,null,wp.element.createElement(E,{value:i,onInput:p,onChange:u,settings:r},wp.element.createElement(G,null,wp.element.createElement(x,null,wp.element.createElement(I,null,wp.element.createElement("div",{className:"editor-styles-wrapper"},wp.element.createElement(wp.blockEditor.BlockList,null))))),wp.element.createElement(P.Slot,null)))),wp.element.createElement("div",{className:"greenergy-notices"},wp.element.createElement(D,{notices:m,onRemove:e=>g(m.filter(n=>n.id!==e))})))},w=()=>{console.log("Greenergy Admin: Initializing...");let i=document.getElementById("greenergy-admin-app");if(i){if(!wp.element){console.error("Greenergy Admin: wp.element is missing!"),i.innerHTML='<div class="error"><p>Error: WordPress dependencies incorrectly loaded.</p></div>';return}try{N(i).render(wp.element.createElement(M,null)),console.log("Greenergy Admin: Rendered.")}catch(a){console.error("Greenergy Admin: Render Error",a),i.innerHTML='<div class="error"><p>Critical Error: '+a.message+"</p></div>"}}else console.error("Greenergy Admin: Root element #greenergy-admin-app not found.")};wp.domReady?wp.domReady(w):document.addEventListener("DOMContentLoaded",w);})();
