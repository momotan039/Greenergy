(()=>{var{registerBlockType:M}=wp.blocks,{__:m}=wp.i18n,{useBlockProps:L,MediaUpload:U,MediaUploadCheck:D}=wp.blockEditor,{Button:v,TextControl:S}=wp.components;console.log("Greenergy Admin: Social Media Block JS executed.");var w=()=>{let s="greenergy/social-media-settings",r=p=>{let l=p.toLowerCase().trim();return l.includes("twitter")||l.includes(" x")?"fab fa-twitter":l.includes("facebook")?"fab fa-facebook-f":l.includes("instagram")?"fab fa-instagram":l.includes("linkedin")?"fab fa-linkedin-in":l.includes("youtube")?"fab fa-youtube":l.includes("whatsapp")?"fab fa-whatsapp":l.includes("tiktok")?"fab fa-tiktok":l.includes("snapchat")?"fab fa-snapchat-ghost":l.includes("telegram")?"fab fa-telegram-plane":"fas fa-link"};try{console.log("Greenergy Admin: Attempting to register block:",s),wp.blocks.getBlockType(s)&&(console.log("Greenergy Admin: Block already registered, unregistering first."),wp.blocks.unregisterBlockType(s));let p=M(s,{title:m("Social Media Settings","greenergy"),icon:"share",category:"theme",attributes:{items:{type:"array",default:[]}},edit:({attributes:l,setAttributes:d})=>{let{items:u}=l,y=(a,c,n)=>{let g=[...u];g[a][c]=n,d({items:g})},b=()=>{d({items:[...u,{platform:"",url:"",icon:"",iconId:0}]})},k=a=>{let c=u.filter((n,g)=>g!==a);d({items:c})};return wp.element.createElement("div",{...L({className:"greenergy-card-block"})},wp.element.createElement("div",{className:"greenergy-block-header"},wp.element.createElement("h2",null,m("Social Media Links","greenergy")),wp.element.createElement("p",null,m("Add links to your social media profiles. These will appear in the header and footer.","greenergy"))),wp.element.createElement("div",{className:"greenergy-social-list"},u.map((a,c)=>wp.element.createElement("div",{key:c,className:"greenergy-social-item",style:{border:"1px solid #e2e8f0",padding:"15px",borderRadius:"8px",marginBottom:"15px",background:"#f8fafc"}},wp.element.createElement("div",{className:"social-item-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}},wp.element.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},wp.element.createElement("span",{className:"item-count",style:{fontWeight:"bold",color:"#64748b"}},"#",c+1),wp.element.createElement("div",{style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"#fff",border:"1px solid #cbd5e1",borderRadius:"4px"}},a.icon?wp.element.createElement("img",{src:a.icon,alt:"icon",style:{width:"20px",height:"20px",objectFit:"contain"}}):wp.element.createElement("i",{className:r(a.platform),style:{fontSize:"18px",color:"#1e293b"}})),wp.element.createElement("span",{style:{fontWeight:"600"}},a.platform||m("New Platform","greenergy"))),wp.element.createElement(v,{isDestructive:!0,isSmall:!0,variant:"tertiary",onClick:()=>k(c),icon:"trash",label:m("Remove","greenergy")})),wp.element.createElement("div",{className:"social-item-fields",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"}},wp.element.createElement(S,{label:m("Platform Name","greenergy"),value:a.platform,onChange:n=>y(c,"platform",n),placeholder:m("Example: Twitter","greenergy")}),wp.element.createElement(S,{label:m("URL","greenergy"),value:a.url,onChange:n=>y(c,"url",n),placeholder:"https://"})),wp.element.createElement("div",{className:"social-icon-picker",style:{marginTop:"10px"}},wp.element.createElement(D,null,wp.element.createElement(U,{onSelect:n=>{y(c,"icon",n.url),y(c,"iconId",n.id)},allowedTypes:["image"],render:({open:n})=>wp.element.createElement(v,{variant:"secondary",onClick:n,style:{width:"100%"}},a.icon?m("Change Custom Icon","greenergy"):m("Upload Custom Icon (Optional)","greenergy"))}),a.icon&&wp.element.createElement(v,{isDestructive:!0,isLink:!0,onClick:()=>{y(c,"icon",""),y(c,"iconId",0)},style:{marginTop:"5px"}},m("Remove Custom Icon (use default)","greenergy"))))))),wp.element.createElement("div",{className:"add-item-wrapper",style:{marginTop:"20px"}},wp.element.createElement(v,{variant:"primary",icon:"plus",onClick:b,style:{width:"100%",height:"40px",justifyContent:"center"}},m("Add New Platform","greenergy"))))},save:()=>null});console.log("Greenergy Admin: Block registered result:",p?"SUCCESS":"FAILED")}catch(p){console.error("Greenergy Admin: Block registration EXCEPTION:",p)}};wp&&wp.blocks&&wp.blocks.registerBlockType?w():wp.domReady?wp.domReady(w):document.addEventListener("DOMContentLoaded",w);var{registerBlockType:O}=wp.blocks,{__:o}=wp.i18n,{MediaUpload:T,MediaUploadCheck:x}=wp.blockEditor,{Button:N,PanelBody:E,TextControl:h,SelectControl:F,CheckboxControl:W,BaseControl:I,ToggleControl:G}=wp.components,_=({attributes:s,setAttributes:r})=>{let{bannerType:p,bannerImage:l,bannerVideo:d,bannerTitle:u,showBannerTitle:y=!0,bannerSubtitle:b,showBannerSubtitle:k=!0,shareProviders:a}=s,c=e=>r({bannerImage:e.url}),n=e=>r({bannerVideo:e.url}),g=[{label:"\u0648\u0627\u062A\u0633\u0627\u0628",value:"whatsapp"},{label:"\u062A\u064A\u0644\u064A\u062C\u0631\u0627\u0645",value:"telegram"},{label:"\u0641\u064A\u0633\u0628\u0648\u0643",value:"facebook"},{label:"\u0625\u0646\u0633\u062A\u063A\u0631\u0627\u0645",value:"instagram"},{label:"\u064A\u0648\u062A\u064A\u0648\u0628",value:"youtube"},{label:"RSS",value:"rss"},{label:"\u0646\u0633\u062E \u0627\u0644\u0631\u0627\u0628\u0637",value:"copy"}],i=(e,t)=>{let f=[...a||[]];e?f.includes(t)||f.push(t):f=f.filter(R=>R!==t),r({shareProviders:f})};return wp.element.createElement("div",{className:"greenergy-news-settings-block",style:{padding:"20px",background:"#fff",border:"1px solid #ccc"}},wp.element.createElement("h2",{style:{borderBottom:"1px solid #eee",paddingBottom:"10px",marginBottom:"20px"}},o("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0623\u062E\u0628\u0627\u0631","greenergy")),wp.element.createElement(E,{title:o("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0627\u0644\u0639\u0627\u0645\u0629","greenergy"),initialOpen:!0},wp.element.createElement(F,{label:o("\u0646\u0648\u0639 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy"),value:p,options:[{label:"\u0635\u0648\u0631\u0629",value:"image"},{label:"\u0641\u064A\u062F\u064A\u0648",value:"video"}],onChange:e=>r({bannerType:e})}),p==="image"&&wp.element.createElement(I,{label:o("\u0635\u0648\u0631\u0629 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy")},wp.element.createElement(x,null,wp.element.createElement(T,{onSelect:c,allowedTypes:["image"],value:l,render:({open:e})=>wp.element.createElement(wp.element.Fragment,null,l&&wp.element.createElement("img",{src:l,style:{maxWidth:"100%",marginBottom:"10px",display:"block"},alt:"Banner"}),wp.element.createElement(N,{variant:"secondary",onClick:e,style:{marginBottom:"10px"}},o(l?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0635\u0648\u0631\u0629":"\u0631\u0641\u0639 \u0635\u0648\u0631\u0629","greenergy")))})),wp.element.createElement(h,{label:o("\u0623\u0648 \u0623\u062F\u062E\u0644 \u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629","greenergy"),value:l,onChange:e=>r({bannerImage:e}),help:o("\u064A\u0645\u0643\u0646\u0643 \u0625\u062F\u062E\u0627\u0644 \u0631\u0627\u0628\u0637 \u062E\u0627\u0631\u062C\u064A \u0644\u0644\u0635\u0648\u0631\u0629 \u0645\u0628\u0627\u0634\u0631\u0629","greenergy")})),p==="video"&&wp.element.createElement(I,{label:o("\u0641\u064A\u062F\u064A\u0648 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy")},wp.element.createElement(x,null,wp.element.createElement(T,{onSelect:n,allowedTypes:["video"],value:d,render:({open:e})=>wp.element.createElement(wp.element.Fragment,null,d&&wp.element.createElement("video",{src:d,style:{maxWidth:"100%",marginBottom:"10px",display:"block"},controls:!0}),wp.element.createElement(N,{variant:"secondary",onClick:e,style:{marginBottom:"10px"}},o(d?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0641\u064A\u062F\u064A\u0648":"\u0631\u0641\u0639 \u0641\u064A\u062F\u064A\u0648","greenergy")))})),wp.element.createElement(h,{label:o("\u0623\u0648 \u0623\u062F\u062E\u0644 \u0631\u0627\u0628\u0637 \u0627\u0644\u0641\u064A\u062F\u064A\u0648","greenergy"),value:d,onChange:e=>r({bannerVideo:e}),help:o("\u064A\u0645\u0643\u0646\u0643 \u0625\u062F\u062E\u0627\u0644 \u0631\u0627\u0628\u0637 \u062E\u0627\u0631\u062C\u064A \u0644\u0644\u0641\u064A\u062F\u064A\u0648 (MP4) \u0645\u0628\u0627\u0634\u0631\u0629","greenergy")})),wp.element.createElement("div",{style:{marginTop:"20px"}},wp.element.createElement(G,{label:o("\u0639\u0631\u0636 \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy"),checked:y,onChange:e=>r({showBannerTitle:e}),help:o(y?"\u0633\u064A\u0638\u0647\u0631 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0641\u064A \u0627\u0644\u0644\u0627\u0641\u062A\u0629":"\u0633\u064A\u062A\u0645 \u0625\u062E\u0641\u0627\u0621 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0645\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy")}),y&&wp.element.createElement(h,{label:o("\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A","greenergy"),value:u,onChange:e=>r({bannerTitle:e}),help:o("\u064A\u0633\u062A\u062E\u062F\u0645 \u0643\u0627\u0641\u062A\u0631\u0627\u0636\u064A \u0625\u0630\u0627 \u0644\u0645 \u064A\u062A\u0645 \u062A\u062D\u062F\u064A\u062F \u0639\u0646\u0648\u0627\u0646 \u0644\u0644\u062E\u0628\u0631","greenergy")}),wp.element.createElement("div",{style:{height:"10px"}}),wp.element.createElement(G,{label:o("\u0639\u0631\u0636 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A","greenergy"),checked:k,onChange:e=>r({showBannerSubtitle:e}),help:o(k?"\u0633\u064A\u0638\u0647\u0631 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0641\u064A \u0627\u0644\u0644\u0627\u0641\u062A\u0629":"\u0633\u064A\u062A\u0645 \u0625\u062E\u0641\u0627\u0621 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0645\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy")}),k&&wp.element.createElement(h,{label:o("\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A","greenergy"),value:b,onChange:e=>r({bannerSubtitle:e})}))),wp.element.createElement(E,{title:o("\u0623\u0632\u0631\u0627\u0631 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629","greenergy"),initialOpen:!1},wp.element.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"}},g.map(e=>wp.element.createElement(W,{key:e.value,label:e.label,checked:(a||[]).includes(e.value),onChange:t=>i(t,e.value)})))))},B=()=>{let s="greenergy/news-settings";console.log("Greenergy Admin: Attempting to register block:",s);try{wp.blocks.getBlockType(s)&&(console.log("Greenergy Admin: Block already registered, unregistering first."),wp.blocks.unregisterBlockType(s));let r=O(s,{title:o("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0623\u062E\u0628\u0627\u0631","greenergy"),description:o("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0648\u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629 \u0627\u0644\u062E\u0627\u0635\u0629 \u0628\u0635\u0641\u062D\u0629 \u0627\u0644\u0623\u062E\u0628\u0627\u0631.","greenergy"),category:"theme",icon:"format-aside",attributes:{bannerType:{type:"string",default:"image"},bannerImage:{type:"string",default:""},bannerVideo:{type:"string",default:""},bannerTitle:{type:"string",default:""},bannerSubtitle:{type:"string",default:"\u0627\u0644\u0623\u062E\u0628\u0627\u0631"},shareProviders:{type:"array",default:["whatsapp","telegram","facebook","instagram","youtube","rss","copy"]}},edit:_,save:()=>null});console.log("Greenergy Admin: News Settings Block registered result:",r?"SUCCESS":"FAILED")}catch(r){console.error("Greenergy Admin: News Settings Block registration EXCEPTION:",r)}};wp&&wp.blocks&&wp.blocks.registerBlockType?B():wp.domReady?wp.domReady(B):document.addEventListener("DOMContentLoaded",B);var{createRoot:Z,useState:C,useEffect:z}=wp.element,{BlockEditorProvider:V,BlockTools:j,WritingFlow:H,ObserveTyping:X,BlockList:J}=wp.blockEditor,{SlotFillProvider:$,Popover:q,Button:K,SnackbarList:Q}=wp.components,{registerBlockType:ee}=wp.blocks,Y=wp.apiFetch,A=()=>{let[s,r]=C([]),[p,l]=C(!1),[d,u]=C([]);z(()=>{if(console.log("Greenergy Admin: Effect running."),typeof greenergySettings>"u"){console.error("Greenergy Admin: greenergySettings is UNDEFINED!");return}console.log("Greenergy Admin: greenergySettings found:",greenergySettings);let n=greenergySettings.blocks,g=wp.blocks.getBlockTypes().map(i=>i.name);if(console.log("Greenergy Admin: Registered blocks count:",g.length),console.log("Greenergy Admin: Registered blocks list:",g),n&&typeof n=="string"&&n.trim()!==""){console.log("Greenergy Admin: Found saved blocks content (length):",n.length);try{let i=wp.blocks.parse(n);console.log("Greenergy Admin: Parsed blocks successfully. Count:",i.length);let e="greenergy/news-settings";if(!i.some(f=>f.name===e)&&wp.blocks.getBlockType(e)){console.log("Greenergy Admin: News block missing from saved data. Appending default.");let f=wp.blocks.createBlock(e);i.push(f)}r(i)}catch(i){console.error("Greenergy Admin: Error parsing saved blocks:",i)}}else{console.log("Greenergy Admin: No saved blocks or empty. Attempting default init.");let i="greenergy/social-media-settings",e="greenergy/news-settings",t=[];wp.blocks.getBlockType(i)&&t.push(wp.blocks.createBlock(i)),wp.blocks.getBlockType(e)&&t.push(wp.blocks.createBlock(e)),t.length>0?r(t):console.error("Greenergy Admin: Default blocks NOT registered.")}},[]);let y=n=>{r(n)},b=n=>{r(n)},k=async()=>{l(!0);let n=wp.blocks.serialize(s),g=[],i={};s.forEach(t=>{t.name==="greenergy/social-media-settings"&&t.attributes&&t.attributes.items&&(g=[...g,...t.attributes.items]),t.name==="greenergy/news-settings"&&(i=t.attributes)});let e={social_media:g,news_settings:i};try{await Y({path:"/greenergy/v1/save-settings",method:"POST",data:{blocks:n,settings:e}}),a("Settings saved successfully!","success")}catch(t){console.error(t),a(t.message||"Error saving settings.","error")}finally{l(!1)}},a=(n,g="success")=>{let i={id:Date.now(),content:n,status:g};u([...d,i]),setTimeout(()=>{u(e=>e.filter(t=>t.id!==i.id))},3e3)},c={mediaUpload:wp.blockEditor.MediaUpload,hasFixedToolbar:!0};return wp.element.createElement("div",{className:"greenergy-admin-layout"},wp.element.createElement("div",{className:"greenergy-admin-header"},wp.element.createElement("h1",null,"\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0642\u0627\u0644\u0628"),wp.element.createElement("div",{style:{background:"#eee",padding:"5px",margin:"0 10px",fontSize:"10px"}},"Debug: React Loaded"),wp.element.createElement(K,{variant:"primary",isBusy:p,onClick:k},p?"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...":"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A")),wp.element.createElement("div",{className:"greenergy-block-editor"},wp.element.createElement($,null,wp.element.createElement(V,{value:s,onInput:y,onChange:b,settings:c},wp.element.createElement(H,null,wp.element.createElement(X,null,wp.element.createElement(j,null,wp.element.createElement("div",{className:"editor-styles-wrapper"},wp.element.createElement(J,null))))),wp.element.createElement(q.Slot,null)))),wp.element.createElement("div",{className:"greenergy-notices"},wp.element.createElement(Q,{notices:d,onRemove:n=>u(d.filter(g=>g.id!==n))})))},P=()=>{console.log("Greenergy Admin: Initializing...");let s=document.getElementById("greenergy-admin-app");if(s){if(!wp.element){console.error("Greenergy Admin: wp.element is missing!"),s.innerHTML='<div class="notice notice-error"><p>Error: WordPress Element (React) package is missing.</p></div>';return}try{if(wp.element.createRoot)console.log("Greenergy Admin: Using createRoot (React 18+)"),wp.element.createRoot(s).render(wp.element.createElement(A,null));else if(wp.element.render)console.log("Greenergy Admin: Using legacy render"),wp.element.render(wp.element.createElement(A,null),s);else throw new Error("No render method found in wp.element");console.log("Greenergy Admin: Render process started.")}catch(r){console.error("Greenergy Admin: Render Error",r),s.innerHTML=`
                <div class="notice notice-error" style="padding: 20px; border: 2px solid red;">
                    <h3>Critical Error: Admin Panel failed to load</h3>
                    <p><strong>Message:</strong> ${r.message}</p>
                    <p>Check the browser console for more details.</p>
                </div>
            `}}else console.error("Greenergy Admin: Root element #greenergy-admin-app not found.")};wp.domReady?wp.domReady(P):document.addEventListener("DOMContentLoaded",P);})();
