(()=>{var{registerBlockType:P}=wp.blocks,{__:n}=wp.i18n,{MediaUpload:J,MediaUploadCheck:X}=wp.blockEditor,{Button:v,PanelBody:T,TextControl:h,SelectControl:R,CheckboxControl:A,BaseControl:E,ToggleControl:x}=wp.components,I=({attributes:t,setAttributes:r})=>{let{MediaUpload:y}=wp.blockEditor,{bannerType:m,bannerImage:g,bannerVideo:c,bannerTitle:w,showBannerTitle:b=!0,bannerSubtitle:f,showBannerSubtitle:u=!0,shareProviders:k}=t,o=e=>r({bannerImage:e.url}),l=e=>r({bannerVideo:e.url}),i=[{label:"\u0648\u0627\u062A\u0633\u0627\u0628",value:"whatsapp"},{label:"\u062A\u064A\u0644\u064A\u062C\u0631\u0627\u0645",value:"telegram"},{label:"\u0641\u064A\u0633\u0628\u0648\u0643",value:"facebook"},{label:"\u0625\u0646\u0633\u062A\u063A\u0631\u0627\u0645",value:"instagram"},{label:"\u064A\u0648\u062A\u064A\u0648\u0628",value:"youtube"},{label:"RSS",value:"rss"},{label:"\u0646\u0633\u062E \u0627\u0644\u0631\u0627\u0628\u0637",value:"copy"}],s=(e,a)=>{let d=[...k||[]];e?d.includes(a)||d.push(a):d=d.filter(B=>B!==a),r({shareProviders:d})},p=(e,a)=>{let d=wp.media({title:n(e==="image"?"\u0627\u062E\u062A\u0631 \u0635\u0648\u0631\u0629":"\u0627\u062E\u062A\u0631 \u0641\u064A\u062F\u064A\u0648","greenergy"),multiple:!1,library:{type:e}});d.on("select",()=>{let B=d.state().get("selection").first().toJSON();a(B)}),d.open()};return wp.element.createElement("div",{className:"greenergy-news-settings-block",style:{padding:"20px",background:"#fff",border:"1px solid #ccc"}},wp.element.createElement("h2",{style:{borderBottom:"1px solid #eee",paddingBottom:"10px",marginBottom:"20px"}},n("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0635\u0641\u062D\u0629 \u0627\u0644\u062E\u0628\u0631","greenergy")),wp.element.createElement(T,{title:n("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0627\u0644\u0639\u0627\u0645\u0629","greenergy"),initialOpen:!0},wp.element.createElement(R,{label:n("\u0646\u0648\u0639 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy"),value:m,options:[{label:"\u0635\u0648\u0631\u0629",value:"image"},{label:"\u0641\u064A\u062F\u064A\u0648",value:"video"}],onChange:e=>r({bannerType:e})}),m==="image"&&wp.element.createElement(E,{label:n("\u0635\u0648\u0631\u0629 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy")},wp.element.createElement("div",{style:{marginBottom:"15px"}},g&&wp.element.createElement("img",{src:g,style:{maxWidth:"100%",maxHeight:"200px",marginBottom:"10px",display:"block",border:"1px solid #ddd",borderRadius:"4px"},alt:"Banner"}),y?wp.element.createElement(y,{onSelect:o,allowedTypes:["image"],value:g,render:({open:e})=>wp.element.createElement(v,{isSecondary:!0,onClick:e},n(g?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0635\u0648\u0631\u0629":"\u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0646 \u0627\u0644\u0645\u0643\u062A\u0628\u0629","greenergy"))}):wp.element.createElement(v,{isSecondary:!0,onClick:()=>p("image",o)},n(g?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0635\u0648\u0631\u0629":"\u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0646 \u0627\u0644\u0645\u0643\u062A\u0628\u0629 (\u064A\u062F\u0648\u064A)","greenergy"))),wp.element.createElement(h,{label:n("\u0623\u0648 \u0623\u062F\u062E\u0644 \u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629","greenergy"),value:g,onChange:e=>r({bannerImage:e}),help:n("\u064A\u0645\u0643\u0646\u0643 \u0625\u062F\u062E\u0627\u0644 \u0631\u0627\u0628\u0637 \u062E\u0627\u0631\u062C\u064A \u0644\u0644\u0635\u0648\u0631\u0629 \u0645\u0628\u0627\u0634\u0631\u0629","greenergy")})),m==="video"&&wp.element.createElement(E,{label:n("\u0641\u064A\u062F\u064A\u0648 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","greenergy")},wp.element.createElement("div",{style:{marginBottom:"15px"}},c&&wp.element.createElement("video",{src:c,style:{maxWidth:"100%",marginBottom:"10px",display:"block"},controls:!0}),y?wp.element.createElement(y,{onSelect:l,allowedTypes:["video"],value:c,render:({open:e})=>wp.element.createElement(v,{isSecondary:!0,onClick:e},n(c?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0641\u064A\u062F\u064A\u0648":"\u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0646 \u0627\u0644\u0645\u0643\u062A\u0628\u0629","greenergy"))}):wp.element.createElement(v,{isSecondary:!0,onClick:()=>p("video",l)},n(c?"\u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0641\u064A\u062F\u064A\u0648":"\u0627\u062E\u062A\u064A\u0627\u0631 \u0645\u0646 \u0627\u0644\u0645\u0643\u062A\u0628\u0629 (\u064A\u062F\u0648\u064A)","greenergy"))),wp.element.createElement(h,{label:n("\u0623\u0648 \u0623\u062F\u062E\u0644 \u0631\u0627\u0628\u0637 \u0627\u0644\u0641\u064A\u062F\u064A\u0648","greenergy"),value:c,onChange:e=>r({bannerVideo:e}),help:n("\u064A\u0645\u0643\u0646\u0643 \u0625\u062F\u062E\u0627\u0644 \u0631\u0627\u0628\u0637 \u062E\u0627\u0631\u062C\u064A \u0644\u0644\u0641\u064A\u062F\u064A\u0648 (MP4) \u0645\u0628\u0627\u0634\u0631\u0629","greenergy")})),wp.element.createElement("div",{style:{marginTop:"20px"}},wp.element.createElement(x,{label:n("\u0639\u0631\u0636 \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy"),checked:b,onChange:e=>r({showBannerTitle:e}),help:n(b?"\u0633\u064A\u0638\u0647\u0631 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0641\u064A \u0627\u0644\u0644\u0627\u0641\u062A\u0629":"\u0633\u064A\u062A\u0645 \u0625\u062E\u0641\u0627\u0621 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0645\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy")}),b&&wp.element.createElement(h,{label:n("\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A","greenergy"),value:w,onChange:e=>r({bannerTitle:e}),help:n("\u064A\u0633\u062A\u062E\u062F\u0645 \u0643\u0627\u0641\u062A\u0631\u0627\u0636\u064A \u0625\u0630\u0627 \u0644\u0645 \u064A\u062A\u0645 \u062A\u062D\u062F\u064A\u062F \u0639\u0646\u0648\u0627\u0646 \u0644\u0644\u062E\u0628\u0631","greenergy")}),wp.element.createElement("div",{style:{height:"10px"}}),wp.element.createElement(x,{label:n("\u0639\u0631\u0636 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A","greenergy"),checked:u,onChange:e=>r({showBannerSubtitle:e}),help:n(u?"\u0633\u064A\u0638\u0647\u0631 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0641\u064A \u0627\u0644\u0644\u0627\u0641\u062A\u0629":"\u0633\u064A\u062A\u0645 \u0625\u062E\u0641\u0627\u0621 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0645\u0646 \u0627\u0644\u0644\u0627\u0641\u062A\u0629","greenergy")}),u&&wp.element.createElement(h,{label:n("\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0641\u0631\u0639\u064A \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A","greenergy"),value:f,onChange:e=>r({bannerSubtitle:e})}))),wp.element.createElement(T,{title:n("\u0623\u0632\u0631\u0627\u0631 \u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629","greenergy"),initialOpen:!1},wp.element.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"}},i.map(e=>wp.element.createElement(A,{key:e.value,label:e.label,checked:(k||[]).includes(e.value),onChange:a=>s(a,e.value)})))))},S=()=>{let t="greenergy/news-settings";console.log("Greenergy Admin: Attempting to register block:",t);try{wp.blocks.getBlockType(t)&&(console.log("Greenergy Admin: Block already registered, unregistering first."),wp.blocks.unregisterBlockType(t));let r=P(t,{title:n("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0623\u062E\u0628\u0627\u0631","greenergy"),description:n("\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0644\u0627\u0641\u062A\u0629 \u0648\u0627\u0644\u0645\u0634\u0627\u0631\u0643\u0629 \u0627\u0644\u062E\u0627\u0635\u0629 \u0628\u0635\u0641\u062D\u0629 \u0627\u0644\u0623\u062E\u0628\u0627\u0631.","greenergy"),category:"theme",icon:"format-aside",attributes:{bannerType:{type:"string",default:"image"},bannerImage:{type:"string",default:""},bannerVideo:{type:"string",default:""},bannerTitle:{type:"string",default:""},bannerSubtitle:{type:"string",default:"\u0627\u0644\u0623\u062E\u0628\u0627\u0631"},shareProviders:{type:"array",default:["whatsapp","telegram","facebook","instagram","youtube","rss","copy"]}},edit:I,save:()=>null});console.log("Greenergy Admin: News Settings Block registered result:",r?"SUCCESS":"FAILED")}catch(r){console.error("Greenergy Admin: News Settings Block registration EXCEPTION:",r)}};wp&&wp.blocks&&wp.blocks.registerBlockType?S():wp.domReady?wp.domReady(S):document.addEventListener("DOMContentLoaded",S);var{createRoot:$,useState:C,useEffect:L}=wp.element,{BlockEditorProvider:M,BlockTools:O,WritingFlow:D,ObserveTyping:F,BlockList:U}=wp.blockEditor,{SlotFillProvider:V,Popover:W,Button:z,SnackbarList:H}=wp.components,{registerBlockType:j}=wp.blocks,_=wp.apiFetch,N=()=>{let[t,r]=C([]),[y,m]=C(!1),[g,c]=C([]);L(()=>{if(console.log("Greenergy Admin: Effect running."),typeof greenergySettings>"u"){console.error("Greenergy Admin: greenergySettings is UNDEFINED!");return}console.log("Greenergy Admin: greenergySettings found:",greenergySettings);let o=greenergySettings.blocks,l=wp.blocks.getBlockTypes().map(i=>i.name);if(console.log("Greenergy Admin: Registered blocks count:",l.length),console.log("Greenergy Admin: Registered blocks list:",l),o&&typeof o=="string"&&o.trim()!==""){console.log("Greenergy Admin: Found saved blocks content (length):",o.length);try{let s=wp.blocks.parse(o);console.log("Greenergy Admin: Parsed blocks successfully. Count:",s.length);let p="greenergy/news-settings";if(!s.some(a=>a.name===p)&&wp.blocks.getBlockType(p)){console.log("Greenergy Admin: News block missing from saved data. Appending default.");let a=wp.blocks.createBlock(p);s.push(a)}r(s)}catch(s){console.error("Greenergy Admin: Error parsing saved blocks:",s)}let i=[];wp.blocks.getBlockType(newsBlockName)&&i.push(wp.blocks.createBlock(newsBlockName)),i.length>0?r(i):console.error("Greenergy Admin: Default blocks NOT registered.")}},[]);let w=o=>{r(o)},b=o=>{r(o)},f=async()=>{m(!0);let o=wp.blocks.serialize(t),l={};t.forEach(s=>{s.name==="greenergy/news-settings"&&(l=s.attributes)});let i={news_settings:l};try{await _({path:"/greenergy/v1/save-settings",method:"POST",data:{blocks:o,settings:i}}),u("Settings saved successfully!","success")}catch(s){console.error(s),u(s.message||"Error saving settings.","error")}finally{m(!1)}},u=(o,l="success")=>{let i={id:Date.now(),content:o,status:l};c([...g,i]),setTimeout(()=>{c(s=>s.filter(p=>p.id!==i.id))},3e3)},k={mediaUpload:wp.blockEditor.MediaUpload,hasFixedToolbar:!0,hasUploadPermissions:!0};return wp.element.createElement("div",{className:"greenergy-admin-layout"},wp.element.createElement("div",{className:"greenergy-admin-header"},wp.element.createElement("h1",null,"\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0642\u0627\u0644\u0628"),wp.element.createElement("div",{style:{background:"#eee",padding:"5px",margin:"0 10px",fontSize:"10px"}},"Debug: React Loaded"),wp.element.createElement(z,{variant:"primary",isBusy:y,onClick:f},y?"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...":"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A")),wp.element.createElement("div",{className:"greenergy-block-editor"},wp.element.createElement(V,null,wp.element.createElement(M,{value:t,onInput:w,onChange:b,settings:k},wp.element.createElement(D,null,wp.element.createElement(F,null,wp.element.createElement(O,null,wp.element.createElement("div",{className:"editor-styles-wrapper"},wp.element.createElement(U,null))))),wp.element.createElement(W.Slot,null)))),wp.element.createElement("div",{className:"greenergy-notices"},wp.element.createElement(H,{notices:g,onRemove:o=>c(g.filter(l=>l.id!==o))})))},G=()=>{console.log("Greenergy Admin: Initializing...");let t=document.getElementById("greenergy-admin-app");if(t){if(!wp.element){console.error("Greenergy Admin: wp.element is missing!"),t.innerHTML='<div class="notice notice-error"><p>Error: WordPress Element (React) package is missing.</p></div>';return}try{if(wp.element.createRoot)console.log("Greenergy Admin: Using createRoot (React 18+)"),wp.element.createRoot(t).render(wp.element.createElement(N,null));else if(wp.element.render)console.log("Greenergy Admin: Using legacy render"),wp.element.render(wp.element.createElement(N,null),t);else throw new Error("No render method found in wp.element");console.log("Greenergy Admin: Render process started.")}catch(r){console.error("Greenergy Admin: Render Error",r),t.innerHTML=`
                <div class="notice notice-error" style="padding: 20px; border: 2px solid red;">
                    <h3>Critical Error: Admin Panel failed to load</h3>
                    <p><strong>Message:</strong> ${r.message}</p>
                    <p>Check the browser console for more details.</p>
                </div>
            `}}else console.error("Greenergy Admin: Root element #greenergy-admin-app not found.")};wp.domReady?wp.domReady(G):document.addEventListener("DOMContentLoaded",G);})();
